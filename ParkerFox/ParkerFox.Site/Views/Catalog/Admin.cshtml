@model ParkerFox.Site.ViewModels.Store.ProductViewModel

@{
    ViewBag.Title = "Admin";
}
<style>
    #products table{border:0;padding:0;margin:0;border-spacing:0;border-collapse:collapse;width:100%}
</style>

<script type="text/javascript" src="~/Scripts/handlebars.js"></script>
<script type="text/ecmascript">

    var productServer = (function () {
        var productApiUrl = '@Url.RouteUrl("DefaultApi", new {httproute="", controller="product"})';
        
        $(document).ajaxError(function (event, xhr) {
            alert(xhr.status + " : " + xhr.statusText);
        });

        var _getProducts = function () {
            return $.ajax(productApiUrl);
        };

        var _someThing = function () { };

        return {
            getProducts: _getProducts,
            someOtherMethod : _someThing
        };

    }());

    (function () {

        var templates = {};

        var compileTemplates = function () {
            templates.productTable = Handlebars.compile($("#productTable").html());
        };

        var refreshProducts = function () {
            productServer.getProducts().done(showAllProducts);
        };

        var showAllProducts = function (data) {            
            var output = templates.productTable({ products: data });
            
            $('#productTemplateOutput').html(output);
        };


        $(function () {
            compileTemplates();
            refreshProducts();
        });
    }());
</script>

<div id="productTemplateOutput">

</div>

<script id="productTable" type="text/html">
    <table>
        <thead>
        <tr>
            <td>Name</td>
            <td>Unit price</td>
        </tr>
        </thead>
        {{#each products}}
        <tr data-id={{ProductId}}>
            <td>{{Name}}</td>
            <td>{{UnitPrice}}</td>
        </tr>
        {{/each}}
    </table>
</script>