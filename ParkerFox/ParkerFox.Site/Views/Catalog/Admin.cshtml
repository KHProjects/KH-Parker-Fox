@model ParkerFox.Site.ViewModels.Ecommerce.ProductViewModel

@{
    ViewBag.Title = "Admin";
}
<style>
    #products table{border:0;padding:0;margin:0;border-spacing:0;border-collapse:collapse;width:100%}
</style>

<script type="text/javascript" src="~/Scripts/handlebars.js"></script>
<script type="text/ecmascript">

    var productServer = (function () {
        var productApiUrl = '@Url.RouteUrl("DefaultApi", new {httproute="", controller="product"})';
        
        $(document).ajaxError(function (event, xhr) {
            alert(xhr.status + " : " + xhr.statusText);
        });

        var _getAll = function () {
            return $.ajax(productApiUrl);
        };

        var _getById = function (id) {
            return $.ajax(productApiUrl + '/' + id);
        };

        return {
            getAll: _getAll,
            getById : _getById
        };

    }());

    (function () {

        var templates = {};

        var _init = function () {
            compileTemplates();
            $('#productList').on('click', 'table tr', editProduct);
        };

        var compileTemplates = function () {
            templates.productTable = Handlebars.compile($("#list-products").html());
            templates.editProduct = Handlebars.compile($('#edit-product').html());
        };

        var editProduct = function () {
            productServer.getById($(this).attr('data-id')).done(showProductEditor);
        };

        var refreshProducts = function () {
            productServer.getAll().done(showAllProducts);
        };

        var showAllProducts = function (data) {
            var output = templates.productTable({ products: data });
            $('#productList').html(output);
        };

        var showProductEditor = function (product) {
            var output = templates.editProduct(product);
            $('#productEditor').html(output);
        };

        $(function () {
            _init();
            refreshProducts();
        });
    }());
</script>

<div id="productList"></div>

<div id="productEditor"></div>

<script id="list-products" type="text/html">
    <table>
        <thead>
        <tr>
            <td>Name</td>
            <td>Unit price</td>
        </tr>
        </thead>
        {{#each products}}
        <tr data-id={{ProductId}}>
            <td>{{Name}}</td>
            <td>{{UnitPrice}}</td>
        </tr>
        {{/each}}
    </table>
</script>

<script id="edit-product" type="text/html">
    <dl>
        <dt>Name</dt>
        <dd><input type="text" name="Name" value="{{Name}}" /></dd>
        <dt>Unit Price</dt>
        <dd><input type="text" name="UnitPrice" value="{{UnitPrice}}" /></dd>
        <dt>&nbsp;</dt>
        <dd><input id="saveCommand" type="button" value="save" /></dd>
    </dl>
</script>