@model MagHag.Subscriptions.Core.ViewModels.CreateSubscriptionViewModel
@{
    ViewBag.Title = "Index";
}
<script src="~/Scripts/jquery-1.9.1.min.js"></script>
<script src="~/Scripts/jquery.signalR-1.0.1.min.js"></script>
<script src="/signalr/hubs"></script>
<script src="~/Scripts/Publication.js"></script>

<div id="publications">
</div>
<div>
    <input id="publicationName" type="text"/>
    <input id="createPublicationCommand" type="button" value="create publication" />
</div>

@Html.AddStartupScript("MagHag.PublicationManager", "#publications", "/home/publications")

<script>
    $(function () {
        $('#createPublicationCommand').on('click', function() {
            var name = $('#publicationName').val();
            $.ajax({
                url: '/home/CreatePublication',
                type: 'POST',
                data: {PublicationName: name }
            });
        });

        $('#publications').on('click', 'input.subscribe', function (button) {
            var id = $(this).attr('data-PublicationId');
            $.ajax({
                url: '/api/subscription',
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                data : JSON.stringify({PublicationId:id})
            }).done(function() {
                console.log('done');
            });
        });
    });
</script>

@*<script>
    $(function() {
        var connection = $.hubConnection();
        var proxy = connection.createHubProxy('publicationEventNotifier');
        proxy.on('publicationCreated', function (publicationActivated) {
            console.log('pub created picked up by proxy less: ' + publicationActivated.PublicationId);
        });
        connection.start();
    });
</script>*@

<script src="~/Scripts/ConnectionManager.js"></script>
